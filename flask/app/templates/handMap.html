<!-- form-wizard.html -->
{% extends 'base/base.html' %}

{% block page_style %}
    <!-- basic styles -->
    <link href="static/css/bootstrap.min.css" rel="stylesheet" />
    <link rel="stylesheet" href="static/css/font-awesome.min.css" />

    <!--[if IE 7]>
      <link rel="stylesheet" href="static/css/font-awesome-ie7.min.css" />
    <![endif]-->

    <!-- page specific plugin styles -->
    <link rel="stylesheet" href="static/css/jquery.dataTables.css" />
    <link rel="stylesheet" href="static/css/dataTables.colVis.css" />
    <link rel="stylesheet" href="static/css/dataTables.tableTools.css" />
    <link rel="stylesheet" href="/static/css/map/DrawingManager_min.css" />
    <link rel="stylesheet" href="/static/css/map/global.css" />
    <link href="/static/css/map/home.css" rel="stylesheet">
    <link rel="stylesheet" href="/static/css/jquery-ui-1.10.3.full.min.css" />
    <!-- fonts -->
    <link rel="stylesheet" href="static/css/font.css" />
    <!-- ace styles -->
    <link rel="stylesheet" href="static/css/ace.min.css" />
    <link rel="stylesheet" href="static/css/ace-rtl.min.css" />
    <link rel="stylesheet" href="static/css/ace-skins.min.css" />

    <!--[if lte IE 8]>
      <link rel="stylesheet" href="static/css/ace-ie.min.css" />
    <![endif]-->

    <!-- inline styles related to this page -->
    <script type="text/javascript" src="http://api.map.baidu.com/api?v=2.0&ak=6EtTQakGlsmGEg4L54rSpVd2"></script>
    <script type="text/javascript" src="/static/js/map/DrawingManager.js"></script>
    <script type="text/javascript" src="/static/js/map/jquery.cookie.js"></script>
    <script src="/static/js/map/home.js"></script>
    <!-- ace settings handler -->

    <script src="static/js/ace-extra.min.js"></script>

    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->

    <!--[if lt IE 9]>
    <script src="static/js/html5shiv.js"></script>
    <script src="static/js/respond.min.js"></script>
    <![endif]-->
{% endblock %}

{% block siderbar %}
    <div class="sidebar" id="sidebar">
        <script type="text/javascript">
            try{ace.settings.check('sidebar' , 'fixed')}catch(e){}
        </script>
        <ul class="nav nav-list">
            <li>
                <a href="#" class="dropdown-toggle">
                    <i class="icon-reorder"></i>
                    <span class="menu-text"> L网参数管理 </span>
                    <b class="arrow icon-angle-down"></b>
                </a>

                <ul class="submenu">
                    <li>
                        <a href="{{ url_for('mainBlueprint.setlte') }}">
                            <i class="icon-hand-right"></i>
                            配置
                        </a>
                    </li>

                    <li>
                        <a href="{{ url_for('mainBlueprint.ltechk') }}">
                            <i class="icon-hand-right"></i>
                            参数核查
                        </a>
                    </li>

                    <li>
                        <a href="{{ url_for('mainBlueprint.lteqry') }}">
                            <i class="icon-hand-right"></i>
                            参数查询
                        </a>
                    </li>
                </ul>
            </li>

            <li>
                <a href="#" class="dropdown-toggle">
                    <i class="icon-reorder"></i>
                    <span class="menu-text"> C网参数管理 </span>

                    <b class="arrow icon-angle-down"></b>
                </a>

                <ul class="submenu">
                    <li >
                        <a href="tables.html">
                            <i class="icon-hand-right"></i>
                            参数核查
                        </a>
                    </li>

                    <li>
                        <a href="jqgrid.html">
                            <i class="icon-hand-right"></i>
                            参数查询
                        </a>
                    </li>
                </ul>
            </li>

            <li>
                <a href="#" class="dropdown-toggle">
                    <i class="icon-reorder"></i>
                    <span class="menu-text"> 数据管理 </span>

                    <b class="arrow icon-angle-down"></b>
                </a>

                <ul class="submenu">
                    <li>
                        <a href="{{ url_for('mainBlueprint.upload') }}">
                            <i class="icon-hand-right"></i>
                            数据上传
                        </a>
                    </li>

                </ul>
            </li>
            <li class="active open">
                <a href="#" class="dropdown-toggle">
                    <i class="icon-reorder"></i>
                    <span class="menu-text"> 万栋楼宇 </span>

                    <b class="arrow icon-angle-down"></b>
                </a>

                <ul class="submenu">
                    <li class="active">
                        <a href="{{ url_for('mainBlueprint.handMap') }}">
                            <i class="icon-hand-right"></i>
                            掌上优测试统计
                        </a>
                    </li>

                </ul>
            </li>
        </ul><!-- /.nav-list -->

        <div class="sidebar-collapse" id="sidebar-collapse">
            <i class="icon-double-angle-left" data-icon1="icon-double-angle-left" data-icon2="icon-double-angle-right"></i>
        </div>

        <script type="text/javascript">
            try{ace.settings.check('sidebar' , 'collapsed')}catch(e){}
        </script>
    </div>
{% endblock %}

{% block main_content %}
<div class="main-content">
    <div class="breadcrumbs" id="breadcrumbs">
        <script type="text/javascript">
            try{ace.settings.check('breadcrumbs' , 'fixed')}catch(e){}
        </script>

        <ul class="breadcrumb">
            <li>
                <i class="icon-home home-icon"></i>
                <a href="#">Home</a>
            </li>

            <li>
                <a href="#">万栋楼宇</a>
            </li>
            <li class="active">掌上优测试统计</li>
        </ul><!-- .breadcrumb -->
        <div class="nav-search" id="nav-search">
            <form class="form-search">
                <span class="input-icon">
                    <input type="text" placeholder="Search ..." class="nav-search-input" id="nav-search-input" autocomplete="off" />
                    <i class="icon-search nav-search-icon"></i>
                </span>
            </form>
        </div><!-- #nav-search -->
    </div>

    <div class="page-content">
        <div class="row">
            <div class="col-sm-4">
                <div class="widget-box">
                    <div class="widget-header widget-header-flat widget-header-small">
                        <h5>
                            <i class="icon-signal"></i>
                            各区统计
                        </h5>
                        <div class="widget-toolbar no-border">
                            <button class="btn btn-minier btn-primary dropdown-toggle" data-toggle="dropdown">
                                {{ distance }}范围
                                <i class="icon-angle-down icon-on-right bigger-110"></i>
                            </button>
                            <ul class="dropdown-menu pull-right dropdown-125 dropdown-lighter dropdown-caret">
                                <li>
                                    <a href="{{ url_for('mainBlueprint.chg',distance='50') }}" class="blue">
                                        <i class="icon-caret-right bigger-110">&nbsp;</i>
                                        50米
                                    </a>
                                </li>
                                <li>
                                    <a href="{{ url_for('mainBlueprint.chg',distance='100')}}">
                                        <i class="icon-caret-right bigger-110 invisible">&nbsp;</i>
                                        100米
                                    </a>
                                </li>
                                <li>
                                    <a href="{{ url_for('mainBlueprint.chg',distance='200') }}">
                                        <i class="icon-caret-right bigger-110 invisible">&nbsp;</i>
                                        200米
                                    </a>
                                </li>
                                <li>
                                    <a href="{{ url_for('mainBlueprint.chg',distance='300') }}">
                                        <i class="icon-caret-right bigger-110 invisible">&nbsp;</i>
                                        300米
                                    </a>
                                </li>
                                <li>
                                    <a href="{{ url_for('mainBlueprint.chg',distance='400') }}">
                                        <i class="icon-caret-right bigger-110 invisible">&nbsp;</i>
                                        400米
                                    </a>
                                </li>
                                <li>
                                    <a href="{{ url_for('mainBlueprint.chg',distance='500') }}">
                                        <i class="icon-caret-right bigger-110 invisible">&nbsp;</i>
                                        500米
                                    </a>
                                </li>
                                <li>
                                    <a href="{{ url_for('mainBlueprint.chg',distance='800') }}">
                                        <i class="icon-caret-right bigger-110 invisible">&nbsp;</i>
                                        800米
                                    </a>
                                </li>
                            </ul>
                        </div>
                    </div>
                    <div class="widget-body">

                            <div id="container1" style="min-width: 310px; height: 202px; max-width: 600px; margin: 0 auto"></div>

                    </div><!-- /widget-body -->
                </div><!-- /widget-box -->
            </div><!-- /span -->
            <div class="col-sm-8">
                    <div class="tabbable" style="min-width:550px;height:230px">
                        <ul class="nav nav-tabs" id="myTab">
                            {% for row in tn %}
                                {% if loop.index==1 %}
                                    <li class="active">
                                {% else %}
                                    <li>
                                {% endif %}
                                    <a data-toggle="tab" href="#tb{{ loop.index }}">
                                        <i class="green icon-home bigger-110"></i>
                                        {{ row }}
                                    </a>
                                </li>
                            {% endfor %}

                        </ul>

                        <div class="tab-content">
                            {% for row in tn %}
                                {% if loop.index==1 %}
                                    <div id="tb{{ loop.index }}" class="tab-pane in active" style="width:710px;height:170px"></div>
                                {% else %}
                                    <div id="tb{{ loop.index }}" class="tab-pane" style="width:710px;height:170px"></div>
                                {% endif %}
                            {% endfor %}
                        </div>
                    </div>
                </div><!-- /span -->
        </div><!-- /.row -->

        <div class="hr hr-18 dotted"></div>
        <div class="row">
            <div class="col-md-6">
                <div class="mp_shadow_a">
                    <div class="mp_shadow_b">
                        <div class="mp_shadow_c" id="mp_map"></div>
                    </div>
                </div>
            </div>
            <div class="col-md-6">
                <div class="table-responsive">

                    <table id="sample-table-2" class="table table-striped table-bordered table-hover">
                        <thead>
                            <tr>
                                <!-- <th class="hidden-480">地市</th> -->
                                <th>楼群</th>
                                <th>镇区</th>
                                <th>中心</th>
                                <th>经度（百度）</th>
                                <th>纬度（百度）</th>
                                <!-- <th>备注</th> -->
                                <th>采样</th>
                                <th>详情</th>
                                <!-- <th>[-115,-95]</th> -->
                                <!-- <th>[-95,]</th> -->
                            </tr>
                        </thead>

                        <tbody>

                        {% for row in result_ls %}
                            <tr>
                                {% for rs in row %}
                                    {% if rs is number and rs<=5 %}
                                        <td><span class="label label-sm label-warning">{{ rs }}</span></td>
                                    {% else %}
                                        <td>{{ rs }}</td>
                                    {% endif %}

                                {% endfor %}
                                <td><a href="#modal-form" role="button" class="blue" data-toggle="modal"> 详细 </a></td>
                            </tr>
                        {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
            <div id="modal-form" class="modal" tabindex="-1">
                <div class="modal-dialog">
                    <div class="modal-content">
                        <!--
                        <div class="modal-header">
                            <button type="button" class="close" data-dismiss="modal">&times;</button>
                            <h4 class="blue bigger">楼群名称</h4>
                        </div>
                        -->
                        <div class="modal-body overflow-visible">
                            <div class="row">
                                <div id="container2" style="min-width: 310px; height: 400px; max-width: 800px; margin: 0 auto"></div>
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button class="btn btn-sm" data-dismiss="modal">
                                <i class="icon-remove"></i>
                                Cancel
                            </button>
                        </div>
                    </div>
                </div>
            </div><!-- MODAL ENDS -->
        </div>
    </div><!-- /.page-content -->
</div><!-- /.main-content -->
{% endblock %}

{% block page_js %}
<!-- page specific plugin scripts -->

<!--[if lte IE 8]>
		  <script src="static/js/excanvas.min.js"></script>
		<![endif]-->
<script src="static/js/flot/jquery.flot.min.js"></script>
<script src="static/js/flot/jquery.flot.pie.min.js"></script>
<script src="static/js/flot/jquery.flot.resize.min.js"></script>

<script src="static/js/jquery.dataTables.min.js"></script>
<script src="static/js/jquery.dataTables.bootstrap.js"></script>
<script src="static/js/dataTables.colVis.js"></script>
<script src="static/js/dataTables.tableTools.js"></script>
<!-- inline scripts related to this page -->

<!-- index.html -->

    <script>
//Map地图
  $(function(){
    //if (pointtb){alert(pointtb);};

    var body_w = $(window).width();
    var map_height = $(window).height() - 160;//
    var mp_content_w = 320;
    $("#mp_map").css('height', ''+map_height+"px");
    $("#mp_content").css('height', ''+map_height+"px");

    //baidu map初始化
    map = new BMap.Map("mp_map");
    map.enableScrollWheelZoom();
    map.addControl(new BMap.NavigationControl());
    map.addControl(new BMap.ScaleControl());
    map.addControl(new BMap.OverviewMapControl());
    map.addControl(new BMap.MapTypeControl());

    var lng = 113.128066;
    var lat = 23.014706;
    var zoom = 15;
    //alert({{ points }})
    if({{ points }})
    {
        lng={{ points[0] }};
        lat={{ points[1] }};
        zoom = 18;
    }
    map.centerAndZoom(new BMap.Point(lng, lat), zoom); //设置中心点坐标和地图级别。
    get_markers(map);
    //map.addEventListener("click", function(e){
    //                                            add_markers(map, e.point.lng, e.point.lat);
     //                                           alert('点击坐标: ' + e.point.lng + ', ' +e.point.lat);
     //                                        });
  })
  </script>

<!-- tables -->
<script type="text/javascript">
    jQuery(function($) {
        $.fn.dataTable.TableTools.defaults.aButtons = [ "csv"];
        $('#sample-table-2').DataTable( {
            "sDom": 'T<"clear">lfrtip',     //注意官网实例为Dom,C为显示或隐藏列，T为导出
            "bProcessing": true,
            "bAutoWidth": false,    //自适应列宽
            "sScrollX": "100%",     //结合水平滚动条使用
            "bScrollCollapse": true,    //开启水平滚动条
            "sScrollY": "310px",    //开启垂直滚动条
            "bPaginate": true,  //启用分页
            "bJQueryUI": true,
            tableTools: {
                "sSwfPath": "{{ url_for('static',filename='swf/copy_csv_xls_pdf.swf') }}"
            },
            //"aoColumnDefs": [{ "bVisible": false, "aTargets": [0] }]
            "aoColumns": [ { "bSortable": false }, null, null,{"bVisible": true}, {"bVisible": true}, null, null ]
        } );
        $('#sample-table-2 tbody').on('click', 'tr', function () {
            buildingNM = $('td', this).eq(0).text();
            var lng = $('td', this).eq(3).text();
            //var name1 = $('td', this).eq(2).text();
            var lat = $('td', this).eq(4).text();
            var zoom = 17;
            var point = [lng, lat];
            map.centerAndZoom(new BMap.Point(lng, lat), zoom);
            get_markers(map, lng, lat);
            //alert('SUCC')
            get_detail(lng,lat)
        });
    });

    function get_detail(lon, lat){
      var posting = $.post("/getmarkers1", {"points":lon.toString()+','+lat.toString()});
      posting.done(function(data){
        var dataObj = eval("("+data+")");
        //alert('test');
        //alert(dataObj);
        //生成marker
        var data = [];
        for(var x in dataObj) {
            //lng = parseFloat(dataObj[x]["lon"]);
            //alert(lng);
            //lat = parseFloat(dataObj[x]["lat"]);
            data.push(parseFloat(dataObj[x]["RSRP"]));
        $('#container2').highcharts({
            title: {
                text: buildingNM,
                x: -20 //center
            },
            yAxis: {
                title: {
                    text: 'RSRP (db)'
                },
                plotLines: [{
                    value: 0,
                    width: 1,
                    color: '#808080'
                }]
            },
            tooltip: {
                valueSuffix: 'db'
            },
            legend: {
                layout: 'vertical',
                align: 'right',
                verticalAlign: 'middle',
                borderWidth: 0
            },
            series: [{
                data: data
            }]
        });
        };
        //alert(data);
      });

      posting.fail(function(){
        alert("Error: can not get details.");
      });
    }
</script>

<script>
$(function () {
    var barData = {{ sData | safe }};
    var oneX = [];
    var oneY1 = [];
    var oneY2 = [];
    //alert(barData);
    //alert(barData.length);
    for(var i = 0; i<barData.length; i++)
        {
        oneX[i] = [];
        oneY1[i] = [];
        oneY2[i] = [];
            //alert(barData[i]);
        for(var j=0;j<barData[i].length;j++)
            {
                oneX[i][j] = barData[i][j][0];
                oneY1[i][j] = barData[i][j][1]-barData[i][j][2];
                oneY2[i][j] = barData[i][j][2];
            }
        //alert(oneX[i]);
        $('#tb'+ (i+1).toString()).highcharts({                   //图表展示容器，与div的id保持一致
            chart: {type: 'column'},
            legend:{align:'right',verticalAlign:'top',enabled:false},
            title: { text: '' },     //指定图表标题
            xAxis: { categories: oneX[i] },   //指定x轴分组
            yAxis: {
                title: { text: '' },
                labels : {
                    formatter : function() {//设置纵坐标值的样式
                         return this.value + '%';
                        }
                   }
            },                 //指定y轴的标题
            plotOptions: {
                column: { dataLabels: { enabled: true }, stacking: 'percent'}
            },
            tooltip: {
            pointFormat: '<span style="color:{series.color}">{series.name}</span>: <b>{point.y}</b> ({point.percentage:.0f}%)<br/>',
            shared: true
            },
            series: [{ name: '未完成', data: oneY1[i] }, { name: '已完成', data: oneY2[i] } ]     //指定数据列,数据列名,数据
            });
        };
});
</script>

<script type="text/javascript">
$(function () {
      var count = {{ companyCat | safe }};
        //alert(count)
      var data = [];
        <!-- var series = Math.floor(Math.random()*10)+1; -->
       for( var i = 0; i< count.length; i++)
        {
            data[i] = { name: count[i][0], y: count[i][1], x:count[i][2] }
        };
    $('#container1').highcharts({
        chart: {
            plotBackgroundColor: null,
            plotBorderWidth: null,
            plotShadow: false,
            type: 'pie'
        },
        title: {
            text: ''
        },
        tooltip: {
            pointFormat: '任务数: <b>{point.y}</b>'
        },
        plotOptions: {
            pie: {
                allowPointSelect: true,
                cursor: 'pointer',
                dataLabels: {
                    enabled: true,
                    format: '<b>{point.name} </b>完成率: {point.x:.1f} %',
                    style: {
                        color: (Highcharts.theme && Highcharts.theme.contrastTextColor) || 'black'
                    }
                }
            }
        },
        series: [{
            name: "Brands",
            colorByPoint: true,
            data: data
        }]
    });

});
</script>





{% endblock %}